<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Tutorial: The Hypergrid Filter API</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-defaults.html">defaults</a></li><li><a href="module-dynamicProperties.html">dynamicProperties</a></li><li><a href="module-effects.html">effects</a></li><li><a href="module-fields.html">fields</a></li><li><a href="module-images.html">images</a></li><li><a href="module-localization.html">localization</a></li><li><a href="module-src_behaviors_cellProperties.html">src/behaviors/cellProperties</a></li></ul><h3>Classes</h3><ul><li><a href="Base.html">Base</a></li><li><a href="Behavior.html">Behavior</a></li><li><a href="behaviors.JSON.html">JSON</a></li><li><a href="Button.html">Button</a></li><li><a href="CellClick.html">CellClick</a></li><li><a href="CellEditing.html">CellEditing</a></li><li><a href="CellEditor.html">CellEditor</a></li><li><a href="CellEditors.html">CellEditors</a></li><li><a href="CellEvent.html">CellEvent</a></li><li><a href="CellRenderer.html">CellRenderer</a></li><li><a href="CellRenderers.html">CellRenderers</a></li><li><a href="CellSelection.html">CellSelection</a></li><li><a href="Color.html">Color</a></li><li><a href="Column.html">Column</a></li><li><a href="ColumnMoving.html">ColumnMoving</a></li><li><a href="ColumnResizing.html">ColumnResizing</a></li><li><a href="ColumnSelection.html">ColumnSelection</a></li><li><a href="ColumnSorting.html">ColumnSorting</a></li><li><a href="Combo.html">Combo</a></li><li><a href="DataModel.html">DataModel</a></li><li><a href="dataModels.JSON.html">JSON</a></li><li><a href="DataSourceOrigin.html">DataSourceOrigin</a></li><li><a href="Date.html">Date</a></li><li><a href="ErrorCell.html">ErrorCell</a></li><li><a href="Feature.html">Feature</a></li><li><a href="Features.html">Features</a></li><li><a href="Filters.html">Filters</a></li><li><a href="HeaderSubgrid.html">HeaderSubgrid</a></li><li><a href="Hypergrid.html">Hypergrid</a></li><li><a href="KeyPaging.html">KeyPaging</a></li><li><a href="LastSelection.html">LastSelection</a></li><li><a href="module-localization-DateFormatter.html">DateFormatter</a></li><li><a href="module-localization-Formatter.html">Formatter</a></li><li><a href="module-localization-Localization.html">Localization</a></li><li><a href="module-localization-NumberFormatter.html">NumberFormatter</a></li><li><a href="Number.html">Number</a></li><li><a href="OnHover.html">OnHover</a></li><li><a href="Registry.html">Registry</a></li><li><a href="Renderer.html">Renderer</a></li><li><a href="RowResizing.html">RowResizing</a></li><li><a href="RowSelection.html">RowSelection</a></li><li><a href="SelectionModel.html">SelectionModel</a></li><li><a href="SimpleCell.html">SimpleCell</a></li><li><a href="Slider.html">Slider</a></li><li><a href="SparkBar.html">SparkBar</a></li><li><a href="SparkLine.html">SparkLine</a></li><li><a href="Spinner.html">Spinner</a></li><li><a href="Tag.html">Tag</a></li><li><a href="Textfield.html">Textfield</a></li><li><a href="ThumbwheelScrolling.html">ThumbwheelScrolling</a></li><li><a href="TreeCell.html">TreeCell</a></li><li><a href="WritablePoint.html">WritablePoint</a></li></ul><h3>Namespaces</h3><ul><li><a href="dataModels.html">dataModels</a></li></ul><h3>Mixins</h3><ul><li><a href="events.mixin.html">mixin</a></li><li><a href="scrolling.mixin.html">mixin</a></li><li><a href="selection.mixin.html">mixin</a></li><li><a href="themes.mixin.html">mixin</a></li><li><a href="themes.sharedMixin.html">sharedMixin</a></li></ul><h3>Interfaces</h3><ul><li><a href="dataControlInterface.html">dataControlInterface</a></li><li><a href="dataModelAPI.html">dataModelAPI</a></li><li><a href="localizerInterface.html">localizerInterface</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addAllColumnProperties">addAllColumnProperties</a></li><li><a href="global.html#addState">addState</a></li><li><a href="global.html#assignOrDelete">assignOrDelete</a></li><li><a href="global.html#assignProps">assignProps</a></li><li><a href="global.html#cancelEditing">cancelEditing</a></li><li><a href="global.html#cellEventFactory">cellEventFactory</a></li><li><a href="global.html#computeCellsBounds">computeCellsBounds</a></li><li><a href="global.html#dataRow">dataRow</a></li><li><a href="global.html#deferredBehaviorChange">deferredBehaviorChange</a></li><li><a href="global.html#deprecated">deprecated</a></li><li><a href="global.html#dispatchEvent">dispatchEvent</a></li><li><a href="global.html#errorEffectEnd">errorEffectEnd</a></li><li><a href="global.html#findCell">findCell</a></li><li><a href="global.html#getActiveColumns">getActiveColumns</a></li><li><a href="global.html#getColumns">getColumns</a></li><li><a href="global.html#getMinimumLeftPositionToShowColumn">getMinimumLeftPositionToShowColumn</a></li><li><a href="global.html#getTextWidthTruncated">getTextWidthTruncated</a></li><li><a href="global.html#handleKeyDown">handleKeyDown</a></li><li><a href="global.html#initialize">initialize</a></li><li><a href="global.html#rebundleGridRenderers">rebundleGridRenderers</a></li><li><a href="global.html#registry">registry</a></li><li><a href="global.html#reset">reset</a></li><li><a href="global.html#resetCellPropertiesCache">resetCellPropertiesCache</a></li><li><a href="global.html#resetRowHeaderColumnWidth">resetRowHeaderColumnWidth</a></li><li><a href="global.html#resolveCalculator">resolveCalculator</a></li><li><a href="global.html#setAllColumnProperties">setAllColumnProperties</a></li><li><a href="global.html#valOrFunc">valOrFunc</a></li><li><a href="global.html#visibleColumns">visibleColumns</a></li><li><a href="global.html#visibleRows">visibleRows</a></li></ul>
</nav>
<div id="main">

    <h1 class="page-title">Tutorial: The Hypergrid Filter API</h1>

    <section>

<header>
    

    <h2>The Hypergrid Filter API</h2>
</header>

<article>
    <h3>Background</h3><p>A filter module defines an object representing a filter expression. The object should be able to:</p>
<ul>
<li><strong>Load state</strong> for a complete expression, or modify state by adding, modifying, or deleting nodes in the expression tree.</li>
<li><strong>Save state</strong> to persist it for reload in subsequent sessions.</li>
<li><strong>Filter local data</strong> by supporting a <code>test()</code> method for testing data rows against the filter.</li>
<li><strong>Filter remote data</strong> by extracting the filter state, which is then sent to the remote data server, which in turn re-runs the query, creating a new result set, which it then sends back to the client for display.</li>
</ul>
<h4>What is an expression tree?</h4><p>An expressions tree is a hierarchical arrangement of nodes. There are two types of nodes, roots/branches and leaves. A tree consists of a root node which may contain as its child nodes either other expressions (branches, or subexpressions, or subtrees) and/or conditional expressions (terminal nodes, or leaves).</p>
<p>The conditional expressions are terminal nodes, having no child nodes of their own. Each conditional expression node has a column name, relational operator, and a single operand. The operand may be either a literal value or another column name.</p>
<p>It may be helpful to think of subtrees as the parenthesized subexpressions in boolean algebra, or in a SQL <a href="https://msdn.microsoft.com/en-us/library/ms173545.aspx">search condition</a>. In fact, a useful feature of a filter module would be to generate SQL search condition expressions which can be used by a remote server to run a query.</p>
<h3>The API in a nutshell</h3><p>Hypergrid models its filter module interface on the <a href="https://github.com/joneit/filter-tree">filter-tree</a> project.
(For more about filter-tree, a good place to start is its <a href="http://joneit.github.io/filter-tree/doc/tutorial-TOP.html">Theory of Operation page</a>).</p>
<p>The essential Application Programming Interface for a filter module is:</p>
<pre class="prettyprint source lang-javascript"><code>var filter = new FilterTree(options);
filter.setState(state);
state = filter.getState();
filter.test(dataRow); // for local filtering</code></pre><h3>Filter objects and filter modules</h3><p>Instead of <code>FilterTree</code> in the above, you could use any object extended therefrom. You can also use another object entirely from any other filter module, so long as it supports the above essential API calls, instantiation, <code>setState</code>, <code>getState</code>, and the filter's main task, <code>test()</code>, which inspects each row in the result set, comparing it to the current filter expression (or &quot;state&quot;) to determine if the row is to be included in the next grid render or not.</p>
<p>Hypergrid includes a default filter object, called <code>DefaultFilter</code>, extended from <a href="http://joneit.github.io/filter-tree/FilterTree.html">FilterTree</a>. Whenever you point your grid at some new data (such as upon instantiation a new <a href="Hypergrid.html"><code>Hypergrid</code></a> object or on a subsequent call to <a href="behaviors.JSON.html#setData"><code>behaviors.JSON#setData</code></a>), a call is made to the <code>Behavior#getNewFilter</code> method to instantiate a new default filter object for you.</p>
<p>The application programmer has full control of the type of filter to use and how it is set up. You can override the <code>getNewFilter()</code> method to instantiate a <code>DefaultFilter</code> with your own specific options; or you may instantiate a different filter object entirely. Alternatively, you can instantiate a new filter at any time and hand it to the grid by way of the <code>Hypergrid#filter</code> setter.</p>
<h3>Hypergrid's filter</h3><p>The <code>DefaultFilter</code> extension supports Hypergrid's filter requirements. Hypergrid adds some additional semantics to the generic filter expression, maintaining two trunks (nodes that may be empty) off the root node:</p>
<ul>
<li><strong>The left trunk</strong> (<code>filter.children[0]</code> or <code>filter.columnFilters</code>) is for a general table filter that may contain arbitrarily complex hierarchy of subexpressions, referencing any columns.</li>
<li><strong>The right trunk</strong> (<code>filter.children[1]</code> or <code>filter.tableFilter</code>) is for the subexpressions in the column filter cells at the top of each column, under the header. This trunk only contains subexpressions, one for each column with something in its filter cell, and is only ever one level deep. That is, column filters cannot have subexpressions themselves.</li>
</ul>
<h3>Filter schema</h3><p>Filters should be instantiated with a column schema, an array of <a href="http://joneit.github.io/pop-menu/global.html#menuItem">menuItem</a> objects. A column schema informs the filter of the names of the available columns and can be a simple as an array of strings. Or it can be an array of objects, or a mixture of strings and objects. The objects can contain additional column information such as alias (header) and type. A schema item can also be a nested schema array. The purpose of this is merely to create hierarchical drop-downs of column names. (Although note that only one level of nesting is generally supported by browsers.)</p>
<p><code>Behavior#getNewFilter</code> crates a default column schema from the <code>columns</code> array.</p>
<h3>Filter integration with Hypergrid</h3><p>In any case, after any call that sets state on the filter, all three of the following actions <em>must</em> be performed before the next grid render or you will not see the results of the change of state:</p>
<ol>
<li><strong>Filter validation</strong> (<code>grid.filter.invalid()</code>).<br> In addition to validating the filter state, this method also sets some internal state for efficient subsequent execution of the critical <code>test()</code> method.</li>
<li><strong>Filter execution</strong> (<code>grid.behavior.dataModel.applyAnalytics()</code>).<br> This is what calls the filter's <code>test()</code> method on every data row. This is expensive and should not be called more often than necessary!</li>
<li><strong>Update the grid canvas</strong> (<code>grid.behaviorChanged()</code> which calls <code>.repaint()</code>).<br> Must be called at least once before the next animation frame in order to see the results of the filtering.</li>
</ol>
<h3>Filter helper methods</h3><p>The following Hypergrid convenience methods do some of these tasks for you.</p>
<p>This table is read from left to right. Each method calls the method to its right. The methods on the left represent the outer layer; they are higher level and do more than the methods on the right.</p>
<p><em>NOTE: The &quot;shy&quot; hyphens that may appear in the identifiers below should not be taken literally.</em></p>
<table>
<thead>
<tr>
<th>module</th>
<th>Hypergrid</th>
<th>behavior</th>
<th>dataModel</th>
<th>DefaultFilter</th>
<th>hyper-analytics</th>
<th>filter-tree</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>file</em></td>
<td>Hypergrid.js</td>
<td>Behavior.js</td>
<td>dataModel/JSON.js</td>
<td>DefaultFilter.js</td>
<td>DataSource&shy;GlobalFilter.js</td>
<td>&mdash;</td>
</tr>
<tr>
<td><em>prefix</em></td>
<td><code>grid.</code></td>
<td><code>grid.behavior.</code></td>
<td><code>grid.behavior.dataModel.</code></td>
<td><code>grid.filter.</code></td>
<td>&mdash;</td>
<td><code>grid.filter.</code></td>
</tr>
<tr>
<td><em>set up</em></td>
<td><code>filter</code></td>
<td><code>filter</code></td>
<td><code>filter</code></td>
<td>&mdash;</td>
<td><a href="http://openfin.github.io/hyper-analytics/DataSourceGlobalFilter.html#get">get(filter)</a></td>
<td>&mdash;</td>
</tr>
<tr>
<td></td>
<td><code>filter</code><sup>1</sup> = filter</td>
<td><code>filter</code> = filter</td>
<td><code>filter</code><sup>2</sup> = filter</td>
<td>&mdash;</td>
<td><a href="http://openfin.github.io/hyper-analytics/DataSourceGlobalFilter.html#set">set(filter)</a></td>
<td>&mdash;</td>
</tr>
<tr>
<td><em>properties</em></td>
<td>filter.prop(&#x200b;'caseSensitiveData', isSensitive)<sup>1</sup></td>
<td>filter.prop(&#x200b;'caseSensitiveData', isSensitive)</td>
<td>filter.prop(&#x200b;'caseSensitiveData', isSensitive)</td>
<td><code>properties({ caseSensitiveData: isSensitive })</code></td>
</tr>
<tr>
<td><em>grid state</em></td>
<td>&mdash;</td>
<td>&mdash;</td>
<td>&mdash;</td>
<td>&mdash;</td>
<td>&mdash;</td>
<td><a href="http://joneit.github.io/filter-tree/FilterTree.html#getState">getState(options)</a><sup>8</sup></td>
</tr>
<tr>
<td></td>
<td>&mdash;</td>
<td>&mdash;</td>
<td>&mdash;</td>
<td>&mdash;</td>
<td>&mdash;</td>
<td><a href="http://joneit.github.io/filter-tree/FilterTree.html#setState">setState(state, options)</a><sup>8</sup></td>
</tr>
<tr>
<td><em>column</em></td>
<td><code>getFilter(&#x200b;columnIndexOrName, options)</code></td>
<td><code>getFilter(&#x200b;columnIndexOrName, options)</code></td>
<td><code>getFilter(&#x200b;columnIndexOrName, options)</code><sup>3</sup></td>
<td><code>getColumnFilterState(&#x200b;columnIndexOrName, options)</code><sup><sup>4, 5</sup></sup></td>
<td>&mdash;</td>
<td><a href="http://joneit.github.io/filter-tree/FilterTree.html#getState">getState(options)</a><sup>8</sup></td>
</tr>
<tr>
<td></td>
<td><code>setFilter(&#x200b;columnIndexOrName, state, options)</code><sup>1, 9</sup></td>
<td><code>setFilter(&#x200b;columnIndexOrName, state, options)</code></td>
<td><code>setFilter(&#x200b;columnIndexOrName, state, options)</code><sup><sup>2, 3</sup></sup></td>
<td><code>setColumnFilterState(&#x200b;columnIndexOrName, state, options)</code><sup><sup>4, 5, 7</sup></sup></td>
<td>&mdash;</td>
<td><a href="http://joneit.github.io/filter-tree/FilterTree.html#setState">setState(state, options)</a><sup>8</sup></td>
</tr>
<tr>
<td><em>columns</em></td>
<td><code>getFilters(options)</code></td>
<td><code>getFilters(options)</code></td>
<td><code>getFilters(options)</code></td>
<td><code>getColumnFiltersState(&#x200b;options)</code></td>
<td>&mdash;</td>
<td><a href="http://joneit.github.io/filter-tree/FilterTree.html#getState">getState(options)</a><sup>8</sup></td>
</tr>
<tr>
<td></td>
<td><code>setFilters(options)</code><sup>1, 9</sup></td>
<td><code>setFilters(options)</code></td>
<td><code>setFilters(options)</code><sup>3</sup></td>
<td><code>setColumnFiltersState(&#x200b;state, options)</code><sup>7</sup></td>
<td>&mdash;</td>
<td><a href="http://joneit.github.io/filter-tree/FilterTree.html#setState">setState(state, options)</a><sup>8</sup></td>
</tr>
<tr>
<td><em>table</em></td>
<td><code>getTableFilter(options)</code></td>
<td><code>getTableFilter(options)</code></td>
<td><code>getTableFilter(options)</code></td>
<td><code>getTableFilterState(options)</code><sup>6</sup></td>
<td>&mdash;</td>
<td><a href="http://joneit.github.io/filter-tree/FilterTree.html#getState">getState(options)</a><sup>8</sup></td>
</tr>
<tr>
<td></td>
<td><code>setTableFilter(state, options)</code><sup>1</sup></td>
<td><code>setTableFilter(state, options)</code></td>
<td><code>setTableFilter(state, options)</code><sup>2</sup></td>
<td><code>setTableFilterState(state, options)</code><sup>6, 7</sup></td>
<td>&mdash;</td>
<td><a href="http://joneit.github.io/filter-tree/FilterTree.html#setState">setState(state, options)</a><sup>8</sup></td>
</tr>
<tr>
<td><em>test</em></td>
<td>&mdash;</td>
<td>&mdash;</td>
<td><a href="dataModels.JSON.html#applyAnalytics"><code>applyAnalytics()</code></a></td>
<td>&mdash;</td>
<td><a href="http://openfin.github.io/hyper-analytics/DataSourceGlobalFilter.html#apply">apply()</a></td>
<td><a href="http://joneit.github.io/filter-tree/FilterTree.html#test">test(dataRow)</a></td>
</tr>
</tbody>
</table>
<p><sup>1</sup> Updates the grid canvas (calls <a href="Hypergrid.html#behaviorChanged"><code>behaviorChanged()</code></a>) after the set call.<br>
<sup>2</sup> Translates index to name before the set call.<br>
<sup>3</sup> Runs the filter (calls <code>applyAnalytics()</code>) after the set call.<br>
<sup>4</sup> <code>options.syntax</code> may also include <code>'CQL'</code> in addition to standard values.<sup>8</sup> <code>'CQL'</code> is the default syntax for these calls.<br>
<sup>5</sup> Creates/maintains a &quot;flat&quot; subexpression for each column in the right &quot;trunk&quot; with left operand bound to that column specifically.<br>
<sup>6</sup> Replaces left &quot;trunk&quot; with hierarchical subexpression.<br>
<sup>7</sup> Validates <code>state</code>.<br>
<sup>8</sup> <code>options.syntax</code> may be <code>'auto'</code>, <code>'object'</code>, <code>'JSON'</code>, or <code>'SQL'</code>.<br>
<sup>9</sup> Removes visible filter cell editor from the grid before proceeding.</p>
<h4>Caveat</h4><p>The convenience that these helper methods give you come at a cost. Running these follow-up tasks <em>whenever</em> you make a change to the global filter is not always called for. In the case of <code>applyAnalytics</code>, in particular, it should <em>not</em> be called more than be once due to the expense in doing so. Ideally, they should just be called one time, at the end of your event loop. Using the helper functions makes it easy to forget this. Therefore, use them sparingly and intelligently, calling the underlying methods instead when it makes sense to do so.</p>
<h3>Examples</h3>
</article>

</section>

</div>

<br class="clear">

<footer>
    Â© 2018 <a href="http://www.openfin.co" target="_blank">OpenFin</a> All Rights Reserved.
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>